<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="panda_gelslim">
    <xacro:include filename="$(find mmint_franka_description)/robots/hands/gamma.xacro"/>

    <xacro:macro name="panda_gelsight" params="connected_to:='' ns:='' rpy:='0 0 0' xyz:='0 0 0' insert:='false'">
        <joint name="${ns}_hand_joint" type="fixed">
            <parent link="${connected_to}"/>
            <child link="${ns}_hand"/>
            <origin xyz="${xyz}" rpy="${rpy}"/>
        </joint>

        <link name="${ns}_hand">
            <visual>
                <geometry>
                    <mesh filename="package://franka_description/meshes/visual/hand.dae"/>
                </geometry>
            </visual>
            <collision>
                <geometry>
                    <mesh filename="package://franka_description/meshes/collision/hand.stl"/>
                </geometry>
            </collision>
        </link>

        <!--  Left finger  -->
        <joint name="${ns}_finger_joint1" type="prismatic">
            <parent link="${ns}_hand"/>
            <child link="mount_left"/>
            <origin rpy="-1.5707963268 0 0" xyz="0 0 0.06340285"/>
            <axis xyz="0 0 1"/>
            <limit effort="100" lower="0" upper="0.04" velocity="0.2"/>
        </joint>
        <link name="mount_left">
            <visual>
                <origin rpy="3.1415926536 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_attach_gs_mini.obj"/>
                </geometry>
            </visual>
            <collision>
                <origin rpy="3.1415926536 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_attach_gs_mini.obj"/>
                </geometry>
            </collision>
        </link>
        <joint name="mount_joint_left" type="fixed">
            <parent link="mount_left"/>
            <child link="${ns}_leftfinger"/>
            <origin rpy="0 0 0" xyz="0.0 -0.02 0.0175"/>
        </joint>
        <link name="${ns}_leftfinger">
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_adapter_gsmini.obj"/>
                </geometry>
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_adapter_gsmini.obj"/>
                </geometry>
            </collision>
        </link>
        <xacro:if value="${insert}">
            <joint name="${ns}_fingerbox_left_joint" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.0054"/>
                <parent link="${ns}_leftfinger"/>
                <child link="${ns}_fingerbox_left"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:if>
        <xacro:unless value="${insert}">
            <joint name="${ns}_fingerbox_left_joint" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <parent link="${ns}_leftfinger"/>
                <child link="${ns}_fingerbox_left"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:unless>
        <link name="${ns}_fingerbox_left">
            <visual>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_shell_hollow_transformed.obj"/>
                </geometry>
            </visual>
            <collision>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_shell_hollow_transformed.obj"/>
                </geometry>
            </collision>
        </link>
        <xacro:if value="${insert}">
            <joint name="elastomer_joint_left" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.0054"/>
                <parent link="${ns}_leftfinger"/>
                <child link="elastomer_left"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:if>
        <xacro:unless value="${insert}">
            <joint name="elastomer_joint_left" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <parent link="${ns}_leftfinger"/>
                <child link="elastomer_left"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:unless>
        <link name="elastomer_left">
            <visual>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_elastomer_transformed_both_sides.obj"/>
                </geometry>
            </visual>
            <collision>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_elastomer_transformed_enclosed.obj"/>
                </geometry>
            </collision>
        </link>
        <joint name="elastomer_tip_joint_left" type="fixed">
            <!-- <origin rpy="1.5707963267948966 0 0" xyz="0.0 -0.00255914 0.06776"/>  -->
            <origin rpy="3.141592653589793 0 0" xyz="-0.00050001 -0.05975001 -0.01125"/>
            <parent link="${ns}_fingerbox_left"/>
            <child link="elastomer_tip_left"/>
            <axis xyz="0 0 0"/>
        </joint>
        <link name="elastomer_tip_left"/>
        <joint name="${ns}_fingertip_joint1" type="fixed">
            <parent link="${ns}_fingerbox_left"/>
            <child link="${ns}_leftfingertip"/>
            <!--0.08388700 (franka_finger_length)-->
            <origin rpy="0 0 0" xyz="0 -0.07388700 0"/>
        </joint>
        <link name="${ns}_leftfingertip"/>

        <!--  Right finger  -->
        <joint name="${ns}_finger_joint2" type="prismatic">
            <parent link="${ns}_hand"/>
            <child link="mount_right"/>
            <origin rpy="-1.5707 0 3.1415926536" xyz="0 0 0.06340285"/>
            <axis xyz="0 0 1"/>
            <limit effort="100" lower="0.0" upper="0.04" velocity="0.2"/>
        </joint>
        <link name="mount_right">
            <visual>
                <origin rpy="3.1415926536 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_attach_gs_mini.obj"/>
                </geometry>
            </visual>
            <collision>
                <origin rpy="3.1415926536 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_attach_gs_mini.obj"/>
                </geometry>
            </collision>
        </link>
        <joint name="mount_joint_right" type="fixed">
            <origin rpy="0 0 0" xyz="0.0 -0.02 0.0175"/>
            <parent link="mount_right"/>
            <child link="${ns}_rightfinger"/>
            <axis xyz="0 0 0"/>
        </joint>
        <link name="${ns}_rightfinger">
            <visual>
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_adapter_gsmini.obj"/>
                </geometry>
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/panda_adapter_gsmini.obj"/>
                </geometry>
            </collision>
        </link>
        <xacro:if value="${insert}">
            <joint name="${ns}_fingerbox_right_joint" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.0054"/>
                <parent link="${ns}_rightfinger"/>
                <child link="${ns}_fingerbox_right"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:if>
        <xacro:unless value="${insert}">
            <joint name="${ns}_fingerbox_right_joint" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <parent link="${ns}_rightfinger"/>
                <child link="${ns}_fingerbox_right"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:unless>
        <link name="${ns}_fingerbox_right">
            <visual>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_shell_hollow_transformed.obj"/>
                </geometry>
            </visual>
            <collision>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_shell_hollow_transformed.obj"/>
                </geometry>
            </collision>
        </link>
        <xacro:if value="${insert}">
            <joint name="elastomer_joint_right" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.0054"/>
                <parent link="${ns}_rightfinger"/>
                <child link="elastomer_right"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:if>
        <xacro:unless value="${insert}">
            <joint name="elastomer_joint_right" type="fixed">
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <parent link="${ns}_rightfinger"/>
                <child link="elastomer_right"/>
                <axis xyz="0 0 0"/>
            </joint>
        </xacro:unless>
        <link name="elastomer_right">         <!-- surface tip of the elastomer  -->
            <visual>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_elastomer_transformed_both_sides.obj"/>
                </geometry>
            </visual>
            <collision>
                <geometry>
                    <mesh filename="package://mmint_franka_description/meshes/visual/gelsight/gsmini_elastomer_transformed_enclosed.obj"/>
                </geometry>
            </collision>
        </link>
        <joint name="elastomer_tip_joint_right" type="fixed">
            <!-- <origin rpy="1.5707963267948966 0 0" xyz="0.0 -0.00255914 0.06776"/> -->
            <origin rpy="3.141592653589793 0 0" xyz="-0.00050001 -0.05975001 -0.01125"/>
            <parent link="${ns}_fingerbox_right"/>
            <child link="elastomer_tip_right"/>
            <axis xyz="0 0 0"/>
        </joint>
        <link name="elastomer_tip_right"/>
        <joint name="${ns}_fingertip_joint2" type="fixed">
            <parent link="${ns}_fingerbox_right"/>
            <child link="${ns}_rightfingertip"/>
            <!--0.08388700 (franka_finger_length)-->
            <origin rpy="0 0 0" xyz="0 -0.07388700 0"/>
        </joint>
        <link name="${ns}_rightfingertip"/>

        <!-- Grasp center -->
        <joint name="${ns}_fingertip_centered_joint" type="fixed">
            <parent link="${ns}_hand"/>
            <child link="grasp_frame"/>
            <origin rpy="0 0 0" xyz="0 0 0.14315286"/>
        </joint>
        <link name="grasp_frame"/>

    </xacro:macro>
</robot>